<!-- Include Editor style. -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/froala-editor/2.7.1/css/froala_editor.min.css" rel="stylesheet" type="text/css" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/froala-editor/2.7.1/css/froala_style.min.css" rel="stylesheet" type="text/css" />

<!-- Include Editor Plugins style. -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/froala-editor/2.7.1/css/plugins/char_counter.css" media="print" onload="this.media='all'">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/froala-editor/2.7.1/css/plugins/code_view.css" media="print" onload="this.media='all'">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/froala-editor/2.7.1/css/plugins/image.css" media="print" onload="this.media='all'">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/froala-editor/2.7.1/css/plugins/file.css" media="print" onload="this.media='all'">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/froala-editor/2.7.1/css/plugins/image_manager.css" media="print" onload="this.media='all'">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/froala-editor/2.7.1/css/plugins/line_breaker.css" media="print" onload="this.media='all'">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/froala-editor/2.7.1/css/plugins/quick_insert.css" media="print" onload="this.media='all'">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/froala-editor/2.7.1/css/plugins/table.css" media="print" onload="this.media='all'">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/froala-editor/2.7.1/css/plugins/colors.min.css" media="print" onload="this.media='all'">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/froala-editor/2.7.1/css/plugins/video.css" media="print" onload="this.media='all'">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/froala-editor/2.7.1/css/plugins/draggable.min.css" media="print" onload="this.media='all'">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/froala-editor/2.7.1/css/plugins/special_characters.min.css" media="print" onload="this.media='all'">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/froala-editor/2.7.1/css/third_party/embedly.min.css" media="print" onload="this.media='all'">

<style>
    .fr-toolbar { border-top: none; }
    .fr-toolbar .fr-command.fr-btn i, .fr-popup .fr-command.fr-btn i { font-size: 12px; }
    .fr-dib fr-draggable { width: auto !important; }
    .fr-image-container strong { font-size: 12px; padding: 5px; word-wrap: break-word; text-align: center; display: block; width: 90%; margin: 0 auto; font-weight: 300; }
    .fr-modal input.search {margin: 10px auto 5px; font-size: 16px; height: 30px; border: 1px solid #c3c3c3; }
    input.icon { padding:3px !important; }
    input.icon::-webkit-input-placeholder { font-family:'FontAwesome'; }
    input.icon::-moz-placeholder { font-family:'FontAwesome'; }
    input.icon::-ms-input-placeholder { font-family:'FontAwesome'; }
</style>

<!-- Include JS files. -->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/froala-editor/2.7.1/js/froala_editor.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/froala-editor/2.7.1/js/languages/pt_br.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/froala-editor/2.7.1/js/plugins/align.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/froala-editor/2.7.1/js/plugins/char_counter.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/froala-editor/2.7.1/js/plugins/code_view.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/froala-editor/2.7.1/js/plugins/entities.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/froala-editor/2.7.1/js/plugins/image.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/froala-editor/2.7.1/js/plugins/file.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/froala-editor/2.7.1/js/plugins/image_manager.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/froala-editor/2.7.1/js/plugins/line_breaker.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/froala-editor/2.7.1/js/plugins/link.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/froala-editor/2.7.1/js/plugins/lists.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/froala-editor/2.7.1/js/plugins/paragraph_format.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/froala-editor/2.7.1/js/plugins/quick_insert.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/froala-editor/2.7.1/js/plugins/table.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/froala-editor/2.7.1/js/plugins/colors.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/froala-editor/2.7.1/js/plugins/save.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/froala-editor/2.7.1/js/plugins/url.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/froala-editor/2.7.1/js/plugins/video.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/froala-editor/2.7.1/js/plugins/draggable.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/froala-editor/2.7.1/js/plugins/special_characters.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/froala-editor/2.7.1/js/plugins/quote.min.js"></script>
<script src="https://cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/froala-editor/2.7.1/js/third_party/embedly.min.js"></script>

<script>
    window.addEventListener('load', (event) => {
        let editor = $(".richEditor");

        $.FroalaEditor.DefineIcon('insertPostIntagram', {NAME: 'instagram'});
        $.FroalaEditor.RegisterCommand('insertPostIntagram', {
            title: 'Inserir postagem Instagram',
            focus: false,
            undo: false,
            refreshAfterCallback: false,
            callback: function () {
                let link_instagram = prompt("Link do Instagram:");

                if (link_instagram) {
                    let p = link_instagram.split('/')[4];

                    if (p) {
                        this.html.insert(`<div class"embedPostIntagram"><iframe src="https://www.instagram.com/p/${p}/embed/captioned/" allowtransparency="true" allowfullscreen="true" frameborder="0" height="900" data-instgrm-payload-id="instagram-media-payload-0" scrolling="no" style="background: white; max-width: 658px; width: calc(100% - 2px); border-radius: 3px; border: 1px solid rgb(219, 219, 219); box-shadow: none; display: block; margin: 0px 0px 12px; min-width: 326px; padding: 0px;"></iframe></div>`);
                    }
                }

                this.events.focus();
            }
        });

        $.FroalaEditor.DefineIcon('image', {NAME: 'file-image-o'});
        $.FroalaEditor.RegisterCommand('image', {
            title: 'Inserir imagem do banco de imagens',
            focus: false,
            undo: false,
            refreshAfterCallback: false,
            callback: function () {
                let janela = window.open('{{ route('admin.images.selectImage', ['richEditor']) }}', '', 'height=800 width='+($(window).width() - 50)+', top=' + ($(window).height() / 2 - 275) + ', left=' + ($(window).width() / 2 - 225) + ', toolbar=0, location=0, menubar=0, directories=0, scrollbars=0');
            }
        });

        editor.froalaEditor({
            requestHeaders: {
                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
            },
            pastePlain: true,
            language: 'pt_br',
            linkAutoPrefix: 'http://',
            toolbarSticky: true,
            toolbarButtons: ['undo', 'redo' , '|', 'paragraphFormat', 'quote', 'bold', 'italic', 'underline', 'strikeThrough', 'color', '|', 'formatUL', 'formatOL', 'align', 'outdent', 'indent', '|', 'insertImage', 'image', 'insertFile', 'insertVideo', 'insertLink', 'insertPostIntagram', 'embedly', 'insertHR', '|', 'clearFormatting', 'insertTable', 'specialCharacters', 'html'],
            toolbarButtonsXS: ['undo', 'redo' , '|', 'paragraphFormat', 'quote', 'color', 'bold', 'italic', 'formatUL', 'align', 'insertImage', 'image', 'insertVideo', 'insertFile', 'insertLink', 'insertPostIntagram', 'embedly', 'insertTable'],
            toolbarButtonsMD: ['undo', 'redo' , '|', 'paragraphFormat', 'quote', 'color', 'bold', 'italic', 'formatUL', 'align', 'insertImage', 'image', 'insertVideo', 'insertFile', 'insertLink', 'insertPostIntagram', 'embedly', 'insertTable'],
            quickInsertButtons: ['image', 'video', 'ol', 'ul'],
            imageUploadURL: '{{ route('froala.uploadFile') }}',
            imageUploadParam: "upload",
            imageUploadParams: {
                crud_id: {{ $crud_id }},
                model: "{{ $model }}",
            },
            fileUploadURL: '{{ route('froala.uploadFile') }}',
            fileUploadParam: "upload",
            fileUploadParams: {
                crud_id: {{ $crud_id }},
                model: "{{ $model }}",
            },
            fileMaxSize: 25 * 1024 * 1024,
            imageMaxSize: 5 * 1024 * 1024,
            imageDefaultWidth: 800,
            imageAllowedTypes: ['jpeg', 'jpg', 'png', 'gif', 'bmp'], // Allow to upload
            videoUploadParam: "upload",
            videoUploadURL: '{{ route('froala.uploadVideo') }}',
            videoMaxSize: 15 * 1024 * 1024,
            videoAllowedTypes: ['webm', 'jpg', 'ogg', 'mp4'],
        })

        $(".fr-wrapper div")
            .find("a[href='https://www.froala.com/wysiwyg-editor?k=u']")
            .remove();
    });
</script>

<script>
    window.addEventListener("message", function(event) {
        let selectedImages = event.data.selectedImages || [];

        if (selectedImages.length === 0) {
            return false;
        }

        if (event.data.source === 'richEditor') {
            console.table(selectedImages);

            let editor = $(".richEditor");

            selectedImages.forEach(function (image) {
                let path_image = image.imageUrl;
                let legend_image = image.legend;
                let credit_image = image.credit;

                let htmlImage = `<p style="text-align: center;">
                                    <span class="fr-img-caption fr-fic fr-dii fr-draggable">
                                        <span class="fr-img-wrap" style="width: 380px;">
                                            <img src="${path_image}">
                                            <span class="fr-inner">${legend_image}</span>
                                        </span>
                                    </span>
                                </p><p></p>`;

                editor.froalaEditor('html.insert', htmlImage, true);
                editor.froalaEditor('events.focus');
            });
        }
    }, false);
</script>
